services:
  dnstt-server:
    build: .
    container_name: dnstt-server
    restart: unless-stopped
    environment:
      # Required
      NS_SUBDOMAIN: "${NS_SUBDOMAIN}"
      # Optional
      DNSTT_PORT: "5300"
      MTU_VALUE: "1232"
      # Where to forward tunneled connections (SSH is common)
      TUNNEL_HOST: "127.0.0.1"
      TUNNEL_PORT: "22"
    volumes:
      - dnstt-config:/etc/dnstt
    # Expose UDP/53 on the host while keeping the container listening on UDP/5300 by default.
    #
    # - Container always listens on DNSTT_PORT (default 5300).
    # - Host can additionally expose UDP/53 and forward it to container UDP/5300.
    #
    # Notes:
    # - Publishing host UDP/53 may conflict with other DNS services already bound to 53 on the host.
    # - Ensure your firewall/security group allows inbound UDP/53.
    ports:
      - "${DNSTT_PORT:-5300}:${DNSTT_PORT:-5300}/udp"
      - "53:${DNSTT_PORT:-5300}/udp"

volumes:
  dnstt-config:
